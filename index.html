<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="resources/css/bootstrap.min.css">
    <script src="resources/js/jquery.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>
</head>
<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Sistema de Cadastro Unico</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="vendas.html">Vendas</a></li>
                    <li><a href="Estoque.html">Estoque</a></li>
                    <li><a href="Estoque.html">Contatos</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title text-center">CADASTRO DE CLIENTE</h3>
                    </div>
                    <div class="panel-body">
                        <form action="#" class="form-horizontal">
                            <fieldset>
                                <legend>Dados Pessoais</legend>
                                <div class="form-group">
                                    <label for="Documento" class="col-sm-2 control-label">Documento</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="Documento" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="nome" class="col-sm-2 control-label">Nome</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="nome" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Sexo</label>
                                    <div class="col-sm-4">
                                        <label class="radio-inline">
                                            <input type="radio" name="sexo" value="F"> Feminino
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" name="sexo" value="M"> Masculino
                                        </label>

                                    </div>
                                </div>
                            </fieldset>
                            <fieldset>
                                <legend>Contato</legend>
                                <div class="form-group">
                                    <label for="email" class="col-sm-2 control-label">Email</label>
                                    <div class="col-sm-4">
                                        <input type="email" class="form-control" id="email" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="telefone" class="col-sm-2 control-label">Telefone</label>
                                    <div class="col-sm-4">
                                        <input type="tel" class="form-control" id="telefone" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="fax" class="col-sm-2 control-label">Fax</label>
                                    <div class="col-sm-4">
                                        <input type="tel" class="form-control" id="fax">
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset>
                                <div class="form-group">
                                    <label for="uf" class="col-sm-2 control-label">UF</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" name="uf" id="uf" required>
                                            <option value="">Selecione</option>
                                            <option value="AC">AC</option>
                                            <option value="AL">AL</option>
                                            <option value="AM">AM</option>
                                            <option value="AP">AP</option>
                                            <option value="BA">BA</option>
                                            <option value="CE">CE</option>
                                            <option value="DF">DF</option>
                                            <option value="ES">ES</option>
                                            <option value="GO">GO</option>
                                            <option value="MA">MA</option>
                                            <option value="MG">MG</option>
                                            <option value="MS">MS</option>
                                            <option value="MT">MT</option>
                                            <option value="PA">PA</option>
                                            <option value="PE">PE</option>
                                            <option value="PI">PI</option>
                                            <option value="PR">PR</option>
                                            <option value="RJ">RJ</option>
                                            <option value="RN">RN</option>
                                            <option value="RO">RO</option>
                                            <option value="RR">RR</option>
                                            <option value="RS">RS</option>
                                            <option value="SC">SC</option>
                                            <option value="SE">SE</option>
                                            <option value="SP">SP</option>
                                            <option value="TO">TO</option>
                                        </select>
                                    </div>
                                </div>
                            </fieldset>
                            <button type="button" class="btn btn-primary" onclick="SalvarCadastro();">
                                <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Gravar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title text-center">CLIENTES CADASTRADOS</h3>
            </div>
            <div class="panel-body">
                <a data-toggle="modal" data-target="#myModal" class="btn btn-primary">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Novo
                </a>
                <div class="table-responsive">
                    <table id="ListaCadastro" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Documento</th>
                                <th>NOME</th>
                                <th>EMAIL</th>
                                <th>TELEFONE</th>
                                <th>AÇÕES</th>
                            </tr>
                        </thead>
                        <tbody>
                           
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        
            ListarClientes();

            function AdicionarLinhaTabela(documento, nome, email, telefone) {
                var tabela = $("#ListaCadastro tbody");
                var linha = '<tr>' +
                    '<td>' + documento + '</td>' +
                    '<td>' + nome + '</td>' +
                    '<td>' + email + '</td>' +
                    '<td>' + telefone + '</td>' +
                    '<td>' +
                    '<a href="#" class="btn btn-info btn-sm" onclick="GetCliente(\'' + documento + '\');">' +
                    '<span class="glyphicon glyphicon-pencil"></span> Editar' +
                    '</a> ' +
                    '<a href="#" class="btn btn-danger btn-sm" onclick="DeletarCliente(\'' + documento + '\');">' +
                    '<span class="glyphicon glyphicon-trash"></span> Deletar' +
                    '</a>' +
                    '</td>' +
                    '</tr>';
                tabela.append(linha);
            }

       
            function DeletarCliente(documento) {
                if (confirm("Tem certeza que deseja deletar o cliente com o documento " + documento + "?")) {
                    $.ajax({
                        type: "DELETE",
                        url: "https://localhost:44344/api/Clientes/Deletar?Documento=" + documento,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (msg) {
                            alert('Cliente deletado com sucesso!');
                            location.reload(); 
                        },
                        error: function (msg) {
                            alert('Erro ao deletar cliente: ' + msg.responseText);
                        }
                    });
                }
            }

            function SalvarCadastro() {
                var sexoSelecionado = $("input[name=\"sexo\"]:checked").val();
                var sexoParaAPI = "";

                if (sexoSelecionado === "F") {
                    sexoParaAPI = "F";
                } else if (sexoSelecionado === "M") {
                    sexoParaAPI = "M";
                }

                var Clientes = {
                    documento: $("#Documento").val(),
                    nome: $("#nome").val(),
                    email: $("#email").val(),
                    telefone: $("#telefone").val(),
                    fax: $("#fax").val(),
                    uf: $("#uf").val(),
                    sexo: sexoParaAPI
                };

                var validar = true;
                var mensagensErro = [];

                if (!Clientes.documento) {
                    mensagensErro.push('O campo documento é obrigatório');
                    $("#Documento").css("background-color", "red");
                    validar = false;
                } else {
                    $("#Documento").css("background-color", "");
                }

                if (!Clientes.nome) {
                    mensagensErro.push('O campo Nome é obrigatório');
                    $("#nome").css("background-color", "red");
                    validar = false;
                } else {
                    $("#nome").css("background-color", "");
                }

                if (!Clientes.sexo) {
                    mensagensErro.push('O campo Sexo é obrigatório');
                    validar = false;
                }

                if (!validar) {
                    alert(mensagensErro.join("\n"));
                    return;
                }

                $.ajax({
                    type: "POST",
                    url: "https://localhost:44344/api/Clientes/Salvar",
                    data: JSON.stringify(Clientes),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (msg) {
                        alert('Sucesso!');
                        location.reload();
                    },
                    error: function (msg) {
                        alert('Erro ao salvar: ' + msg.responseText);
                    }
                });
            }

            function GetCliente(Documento) {
                $.ajax({
                    type: "GET",
                    url: "https://localhost:44344/api/Clientes/GetCliente?Documento=" + Documento,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (OBJ) {
                        $('#myModal').modal('show');
                        $("#Documento").val(OBJ.documento);
                        $("#nome").val(OBJ.nome);
                        $("#email").val(OBJ.email);
                        $("#telefone").val(OBJ.telefone);
                        $("#fax").val(OBJ.fax);
                        $("#uf").val(OBJ.uf);
                        $('input[name="sexo"][value="' + OBJ.sexo + '"]').prop('checked', true);
                    },
                    error: function (OBJ) {
                        alert('Erro ao buscar cliente: ' + OBJ.responseText);
                    }
                });
            }

            function ListarClientes() {
                $.ajax({
                    type: "GET",
                    url: "https://localhost:44344/api/Clientes/Listar",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (OBJ) {
                        $("#ListaCadastro tbody").empty();
                        for (var i = 0; i < OBJ.length; i++) {
                            AdicionarLinhaTabela(OBJ[i].documento, OBJ[i].nome, OBJ[i].email, OBJ[i].telefone);
                        }
                    },
                    error: function (OBJ) {
                        alert('Erro ao listar clientes: ' + OBJ.responseText);
                    }
                });
            }
    </script>



</body>
</html>
